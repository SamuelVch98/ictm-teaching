{% extends "layout.html" %}
{% block pagetitle %}Duplicate Course{% endblock %}
{% block additionalpageheader %}
    <style>
        body {
            background-color: #f8f9fa;
        }

        .container {
            max-width: 800px;
            margin-top: 50px;
        }

        .badge a {
            color: black;
            text-decoration: none;
        }

        .badge a:hover {
            color: red;
        }
    </style>
    <script>
        $(document).ready(function () {
            function formatTeacher(teacher) {
                if (teacher.loading) {
                    return teacher.text;
                }
                var $container = $("<div></div>").text(teacher.text);
                return $container;
            }

            // Ajouter un gestionnaire d'événements pour chaque champ de sélection
            $('[id^=assigned_teachers]').each(function () {
                $(this).select2({
                    placeholder: 'Search for a teacher',
                    multiple: true,
                    minimumInputLength: 1,
                    ajax: {
                        url: "{{ url_for('course.search_teachers') }}",
                        dataType: 'json',
                        delay: 250,
                        data: function (params) {
                            return {
                                q: params.term
                            };
                        },
                        processResults: function (data) {
                            return {
                                results: data
                            };
                        },
                        cache: true
                    },
                    templateResult: formatTeacher,
                    templateSelection: formatTeacher,
                    tags: false
                });
            });
        });
    </script>
    <script>
        $(document).ready(function () {
            $('#organization_code').change(function () {
                var selectedOption = $(this).find('option:selected');
                var selectedValue = selectedOption.val();
                var selectedText = selectedOption.text();

                if (selectedValue) {
                    var tagHtml = '<div class="badge bg-primary" data-id="' + selectedValue + '">' +
                        selectedText + '&nbsp;<a href="#" class="remove-tag">&times;</a>' +
                        '<input type="hidden" name="organization_code[]" value="' + selectedValue + '">' +
                        '</div>';

                    $('#selected-organizations').append(tagHtml);
                    $(this).val('');
                }
            });

            $(document).on('click', '.remove-tag', function (e) {
                e.preventDefault();
                $(this).parent('.badge').remove();
            });
        });
    </script>
{% endblock %}
{% block pagecontent %}
    <h1 class="page-header">{{ course.code }} - {{ course.title }}</h1>
    <hr>
    <h2 class="sub-header">Course informations</h2>
    <hr>
    <div class="row">
        <div class="col-sm-9">
            <form class="form" action="{{ url_for('course.add_duplicate_course') }}" method="post" id="courseInfo">
                <input type="hidden" name="course_id" value="{{ course.id }}">
                <div class="form-group">
                    <div class="col-xs-6">
                        <br>
                        <label for="code"><h4>Code</h4></label>
                        <input type="text" class="form-control" name="code" id="code"
                               placeholder="Code" value="{{ course.code }}">
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-xs-6">
                        <br>
                        <label for="title"><h4>Title</h4></label>
                        <input type="text" class="form-control" name="title" id="title"
                               placeholder="Title"
                               value="{{ course.title }}">
                    </div>
                </div>
                <br>
                <div class="form-group">
                    <label for="quadri"><h4>Quadri</h4></label>
                    <select class="form-select" id="quadri" name="quadri">
                        {% for q in quadri %}
                            {% if q == course.quadri %}
                                <option value="{{ q }}" selected>{{ q }}</option>
                            {% else %}
                                <option value="{{ q }}">{{ q }}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
                <br>
                <div class="form-group">
                    <label for="year"><h4>Year</h4></label>
                    <select class="form-select" id="year" name="year">
                        {% for config in configurations %}
                            <option value="{{ config.year }}" {% if config.year == course.year %}
                                    selected {% endif %}>{{ config.year }}</option>
                        {% endfor %}
                    </select>
                </div>
                <br>
                <div class="form-group">
                    <div class="col-xs-6">
                        <label for="load_needed"><h4>Load Needed</h4></label>
                        <input type="text" class="form-control" name="load_needed" id="load_needed"
                               value="{{ course.load_needed }}">
                    </div>
                </div>
                <br>
                <div class="form-group">
                    <label for="language"><h4>Language</h4></label>
                    <select class="form-select" id="language" name="language">
                        {% for lang in language %}
                            {% if lang == 'fr' %}
                                <option value="{{ lang }}"
                                        {% if course.language == lang %}selected{% endif %}>French
                                </option>
                            {% else %}
                                <option value="{{ lang }}"
                                        {% if course.language == lang %}selected{% endif %}>English
                                </option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <br>
                    <label for="assigned_teachers"><h4>Assign Teachers</h4></label>
                    <select class="form-control" id="assigned_teachers"
                            name="assigned_teachers[]" multiple>
                        {% for t in course.course_teacher %}
                            <option value="{{ t.user_id }}"
                                    selected>{{ t.user.name }} {{ t.user.first_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <br>
                    <label for="organization_code"><h4>Organization Code</h4></label>
                    <select class="form-select" id="organization_code" name="organization_code">
                        <option value="" disabled selected>Select an organization</option>
                        {% for code in organizations_code %}
                            <option value="{{ code.id }}">{{ code.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div id="selected-organizations">
                    {% for org in course.organizations %}
                        <div class="badge bg-primary" data-id="{{ org.id }}">
                            {{ org.name }}&nbsp;<a href="#" class="remove-tag">&times;</a>
                            <input type="hidden" name="organization_code[]" value="{{ org.id }}">
                        </div>
                    {% endfor %}
                </div>
                <div class="form-group">
                    <div class="col-xs-12">
                        <br>
                        <button class="btn btn-lg btn-success" type="submit"><i
                                class="glyphicon glyphicon-ok-sign"></i> Add
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
{% endblock %}